const cacheBuster=(new Date).getTime();async function getText(a){try{var c=await fetch(`${a}?cacheBuster=${cacheBuster}`,{headers:{"Content-Type":"text/plain"}});if(!c.ok)throw Error(`Errore HTTP: ${c.status}`);return await c.text()}catch(b){throw c=b instanceof Error?b.message:"Errore sconosciuto",console.error(`Errore getText()  ${a}:`,c),alert(`Errore getText()  ${a}\n${c}`),b;}}
async function getJson(a){try{var c=await fetch(`${a}?cacheBuster=${cacheBuster}`,{headers:{"Content-Type":"application/json"}});if(!c.ok)throw Error(`Errore HTTP: ${c.status}`);return await c.json()}catch(b){throw c=b instanceof Error?b.message:"Errore sconosciuto",console.error(`Errore getJson()  ${a}:`,c),alert(`Errore getJson()  ${a}\n${c}`),b;}}
function fetchText(a,c){fetch(`${a}?cacheBuster=${cacheBuster}`).then(b=>{if(!b.ok)throw Error(`HTTP error ${b.status}\nfetchText\nurl:${a}`);return b.text()}).then(b=>c(b)).catch(b=>{console.error(`Error fetchText ${a}`,b);alert(`Error fetchText ${a}\n${b}`)})}
function fetchJson(a,c){fetch(`${a}?cacheBuster=${cacheBuster}`).then(b=>{if(!b.ok)throw Error(`HTTP error ${b.status}\nfetchJson\nurl:${a}`);return b.json()}).then(b=>c(b)).catch(b=>{console.error(`Error fetchJson ${a}`,b);alert(`Error fetchJson ${a}\n${b}`)})}
async function getPdf(a){try{var c=await fetch(a);if(!c.ok)throw Error(`Errore HTTP: ${c.status}`);return await c.arrayBuffer()}catch(b){throw c=b instanceof Error?b.message:"Errore sconosciuto",console.error(`Errore getPdf() ${a}:`,c),alert(`Errore getPdf() ${a}\n${c}`),b;}};function openApp(){setTimeout(()=>{initMenu();wnds.init();getTheme();imageCarousel();showSommario()},100)}
const opHome=function(a){showSommario();toggleMenu();UaWindowAdm.closeAll()},opArchivio=function(a){showIndici();toggleMenu();UaWindowAdm.closeAll()},opHelp=function(){toggleMenu();UaWindowAdm.closeAll();wnds.wdiv.open("./html/help0.html")},opNews=function(a){toggleMenu();UaWindowAdm.closeAll();wnds.wdiv.open("./html/help1.html")},opRedazione=function(a){toggleMenu();UaWindowAdm.closeAll();wnds.wdiv.open("./html/redazione.html")},opCollaboatori=function(a){toggleMenu();UaWindowAdm.closeAll();wnds.wdiv.open("./html/collaboratori.html")},
opIPOTESI=function(a){alert("IPOTESI")},opIPubblicita=function(a){alert("pubblicita")},op9=async function(a){alert("op0")},op10=async function(a){alert("op10")};function initMenu(){document.body.classList.add("theme-light");const a=document.querySelector(".menu-h");a.addEventListener("click",toggleMenu);document.addEventListener("keydown",c=>{"Escape"===c.key&&a.classList.contains("active")&&toggleMenu()})}
function toggleMenu(){const a=document.querySelector(".menu-h");a.classList.toggle("active");document.body.classList.toggle("open-menu");const c=document.querySelector(".menu-h-box");a.classList.contains("active")?c.setAttribute("data-tt","Close"):c.setAttribute("data-tt","Open")}function getTheme(){const a=localStorage.getItem("theme");a&&"dark"==a&&setDark()}
function setLight(){document.documentElement.classList.toggle("invert");document.body.classList.remove("theme-dark");document.body.classList.add("theme-light");localStorage.setItem("theme","ligth")}function setDark(){document.documentElement.classList.toggle("invert");document.body.classList.remove("theme-light");document.body.classList.add("theme-dark");localStorage.setItem("theme","dark")}function invertColors(){document.querySelectorAll("*").forEach(a=>{a.classList.add("invert-colors")})}
function enableEsc(a){document.addEventListener("keydown",cmdEsc);a&&("Escape"!==a.key&&27!==a.keyCode||cmdEsc())}function disableEsc(a){document.removeEventListener("keydown",cmdEsc)}function cmdEsc(){closeReader()}const imageCarousel=()=>{document.querySelector(".col-right").querySelectorAll(".item0").forEach(a=>{a.classList.add("active")})};let fontSize=18;const fsizeDef=18,fsizeMax=32,fsizeMin=14,fsizeKey="fsize_reader";var textCurrent="";let urlCurrent="";const fh=a=>`
        <div class="text-reader" id="reader">
            <div class="toolbar">
                <span>chiudi:(Esc)</span>
                <button class="tt-bottom" data-tt="Apri pagina PDF"  onclick="readPDF()">PDF</button>
                <button class="tt-bottom" data-tt="Configura lettore "id="configButton" onclick="toggleSpeak()">\u2699\ufe0f</button>
                <button class="tt-bottom" data-tt="Start/Sop lettore" id="readButton" onclick="toggleReading()">\u25b6</button>
                <button class="tt-bottom" data-tt="Font +" onclick="increaseFontSize()">A+</button>
                <button class="tt-bottom" data-tt="Font -" onclick="decreaseFontSize()">A-</button>
                <button class="tt-left" data-tt="Apri/Chiudi Schermo Intero" onclick="openFullscreen()">\u26f6</button>
                <button class="tt-left" data-tt="Chiudi" onclick="closeReader()">X</button>
            </div>
            <div class="content" id="content">
            ${a}
            </div>
        </div>
`,showReader=a=>{textCurrent=a;h=fh(a);a=UaWindowAdm.create("id_reader");a.setZ(12);a.vw_vh().setXY(.1,10.2,-1);a.setHtml(h);a.show();defaultFontSize()};function openReader(a){urlCurrent=a;fetchText(a,showReader);enableEsc()}
async function readPDF(){path=urlCurrent.replace("data/","data/pdf/").replace(".html",".pdf");try{const a=await getPdf(path),c=new Blob([a],{type:"application/pdf"}),b=URL.createObjectURL(c);window.open(b,"_blank")}catch(a){console.error("Errore durante la lettura del PDF:",a)}}
function closeReader(){disableEsc();closeSpeak();stopReading();UaWindowAdm.close("id_reader");if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}
function defaultFontSize(){var a=localStorage.getItem(fsizeKey);a=parseInt(a,10);isNaN(a)&&(a=fsizeDef);fontSize=a;content.style.fontSize=`${fontSize}px`}function increaseFontSize(){const a=document.getElementById("content");fontSize=Math.min(fontSize+2,fsizeMax);a.style.fontSize=`${fontSize}px`;localStorage.setItem(fsizeKey,fontSize.toString())}
function decreaseFontSize(){const a=document.getElementById("content");fontSize=Math.max(fontSize-2,fsizeMin);a.style.fontSize=`${fontSize}px`;localStorage.setItem(fsizeKey,fontSize.toString())}function openFullscreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};function toggleReading(){tts.toggleReading()}function stopReading(){tts.stopReading()}function closeSpeak(){tts.closeSpeak()}function toggleSpeak(){tts.toggleSpeak()}function saveSpeak(){tts.saveSpeak()}
class TextToSpeech{constructor(){this.panel=this.isReading=!1}openSpeak(){UaJtfh().init();const a=UaWindowAdm.create("id_speak");a.setZ(1E3);a.vw_vh().setXY(30,50,-1);a.setHtml('\n      <div id="configPanel" class="panel-speak">\n      <div class="toolbar">\n        <button  onclick="saveSpeak()">Salva</button>\n        <button  onclick="closeSpeak()">X</button>\n      </div>\n      <div id="id_voices">\n        <p>Volume:<input type="range" name="amplitude" min="0" max="1" step="0.1" value="1"></p>\n        <p>Tono:<input type="range" name="pitch" min="0" max="2" step="0.1" value="1"></p>\n        <p>Velocit\u00e0:<input type="range" name="speed" min="0.5" max="2" step="0.1" value="1"></p>\n        </div>\n      </div>\n      ');a.show();
a.drag();this.setSpeak();this.panel=!0}closeSpeak(){this.saveSpeak();UaWindowAdm.close("id_speak");this.panel=!1}toggleSpeak(){this.panel?this.closeSpeak():this.openSpeak()}setSpeak(){const a=this.loadSettings(),c=document.getElementById("id_voices");c.querySelector('[name="amplitude"]').value=a.amplitude;c.querySelector('[name="pitch"]').value=a.pitch;c.querySelector('[name="speed"]').value=a.speed}saveSpeak(){var a=document.getElementById("id_voices");if(a){var c=a.querySelector('[name="amplitude"]').value,
b=a.querySelector('[name="pitch"]').value;a=a.querySelector('[name="speed"]').value;this.saveSettings(c,b,a)}}saveSettings(a,c,b){localStorage.setItem("amplitude",a);localStorage.setItem("pitch",c);localStorage.setItem("speed",b)}loadSettings(){const a={};a.amplitude=localStorage.getItem("amplitude")||1;a.pitch=localStorage.getItem("pitch")||1;a.speed=localStorage.getItem("speed")||1;for(let c in a)"undefined"===a[c]&&(a[c]="1");return a}stopReading(){this.isReading&&(document.getElementById("readButton").innerText=
"\u25b6",window.speechSynthesis.cancel(),this.isReading=!1)}toggleReading(){if(this.isReading)document.getElementById("readButton").innerText="\u25b6",window.speechSynthesis.cancel(),this.isReading=!1;else{document.getElementById("readButton").innerText="\u23f8";const c=this.loadSettings();var a=this.cleanupText(textCurrent);a=new SpeechSynthesisUtterance(a);a.volume=c.amplitude;a.rate=c.speed;a.pitch=c.pitch;a.lang="it-IT";window.speechSynthesis.speak(a);this.isReading=!0}}cleanupText(a){return a.replace(/<[^>]+>/g,
"").replace(/&[^;]+;/g,"").replace(/[#@*]/g,"")}}const tts=new TextToSpeech;const WndDiv=a=>({w:UaWindowAdm.create(a),out:null,show(c){wnds.closeAll();c=`
<div class="window-text">
<div class="btn-wrapper">
<button  class="tt-left" data-tt="chiudi" onclick="UaWindowAdm.closeThis(this)">X</button>
</div>
<div class="div-text">${c}</div>
</div>
    `;this.w.drag();this.w.setZ(12);this.w.vw_vh().setXY(0,10,-1);this.w.setHtml(c);this.w.show()},close(){this.w.close()},open(c){fetchText(c,b=>this.show(b))}}),wnds={wdiv:null,init(){this.wdiv=WndDiv("id_w0")},closeAll(){UaWindowAdm.close("id_w0")}},showSommario=function(){const a=document.getElementById("id_item1");fetchText("./data/indice.html",c=>{a.innerHTML=c})},showIndici=function(){const a=document.getElementById("id_item1");fetchText("./data/archivio.html",c=>{a.innerHTML=c})};const nodrag_tds=["input","select","a"],nodrag_cls="nodrag";
var UaDrag=function(a){return function(c){let b=0,d=0,f=0,g=0;const l=function(e){e=e||window.event;e.preventDefault();b=f-e.clientX;d=g-e.clientY;f=e.clientX;g=e.clientY;c.style.top=c.offsetTop-d+"px";c.style.left=c.offsetLeft-b+"px"},m=function(){document.onmouseup=null;document.onmousemove=null};c.onmousedown=function(e){e=e||window.event;let k=e.target;!(k=k||null)||nodrag_tds.includes(k.tagName.toLowerCase())||k.classList.contains(nodrag_cls)||(e.preventDefault(),f=e.clientX,g=e.clientY,document.onmouseup=
m,document.onmousemove=l)}}(a)};const UaJtfh=()=>({rows:[],init(){this.rows=[];return this},insert(a){this.rows.unshift(a);return this},append(a){this.rows.push(a);return this},text(a=""){return this.rows.join(a)},html(a=""){return this.rows.join(a).replace(/\s+|\[rn\]/g," ")}});var UaWindowAdm={ws:{},create(a,c=null){let b=document.getElementById(a);b||(b=document.createElement("div"),c?document.getElementById(c).appendChild(b):document.body.appendChild(b),b.id=a,b.setAttribute("data-name","ua-window"),c=this.newUaWindow(b),this.ws[a]=c);a=this.ws[a];b.style.display="none";return a},get(a){return this.ws[a]?this.ws[a]:null},show(a){this.ws[a]&&this.ws[a].show()},close(a){this.ws[a]&&this.ws[a].close()},toggle(a){this.ws[a]&&this.ws[a].toggle()},hide(a){this.ws[a]&&this.ws[a].hide()},
closeThis(a){a=a.closest('[data-name="ua-window"]').id;this.ws[a].close()},showAll(){for(let a in this.ws)this.ws[a].show()},hideAll(){for(let a in this.ws)this.ws[a].hide()},closeAll(){for(let a in this.ws)this.ws[a].close()},remove(a){this.ws[a]&&(document.getElementById(a).remove(),this.ws[a]=null,delete this.ws[a])},removeAll(){for(let a in this.ws)this.remove(a);this.ws={}},newUaWindow(a){let c={initialize(b){this.w=b;this.wy=this.wx="0px";this.isVisible=this.isOpen=!1;this.firstShow=!0;this.wz=
this.pos=0;this.vh=this.vw="px"},vw_vh(){this.vw="vw";this.vh="vh";return this},addClassStyle(b){this.w.classList.contains(b)||this.w.classList.add(b);return this},removeClassStyle(b){this.w.classList.contains(b)&&this.w.classList.remove(b);return this},getWindow(){alert("getWindow => ??");return this.w},getElement(){return this.w},getId(){return this.w.id},setStyle(b){for(const d in b)this.w.style[d]=b[d];return this},setHtml(b){this.w.innerHTML=b;return this},getHtml(){return this.w.innerHTML},
setXY(b,d,f=0){this.wx=b;this.wy=d;this.pos=f;return this},setCenterY(b,d){this.setXY((window.innerWidth-this.w.clientWidth)/2,b,d);return this},setCenter(b){this.setXY((window.innerWidth-this.w.clientWidth)/2,(window.innerHeight-this.w.clientHeight)/2,b);return this},linkToId(b,d,f,g){b=document.getElementById(b);this.linkToElement(b,d,f,g);return this},linkToElement(b,d,f,g){d=b.offsetLeft+b.offsetWidth+d;b=b.offsetTop+f;0>b&&(b=0);this.setXY(d,b,g);return this},setZ(b){this.wz=b;return this},reset(){this.firstShow=
!0;return this},toggle(){this.isVisible?this.hide():this.show();return this},show(){if(this.firstShow||1==this.pos||0===this.pos&&!1===this.isVisible)this.w.style.position="absolute",this.w.style.marginLeft=0,this.w.style.marginTop=0,this.w.style.top=`${this.wy}${this.vh}`,0<=this.wx?this.w.style.left=`${this.wx}${this.vw}`:this.w.style.right=-`${this.wx}${this.vw}`,0<this.wz&&(this.w.style.zIndex=this.wz);this.w.style.display="";this.firstShow=!1;this.isOpen=this.isVisible=!0;return this},hide(){this.w.style.display=
"none";this.isVisible=!1;return this},close(){this.w.style.display="none";this.w.innerHTML="";this.isOpen=!1;return this},remove(){UaWindowAdm.remove(this.w.id);return null},drag(){UaDrag(this.w);return this}};c.initialize(a);return c}};
